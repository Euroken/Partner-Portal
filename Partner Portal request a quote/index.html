
    <style>

        .form-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 48px auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #012B90;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .form-header {
            background: linear-gradient(135deg, #1563FF 0%, #012B90 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .form-header h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-content {
            padding: 2.5rem;
            padding-right: 4rem;
        }

        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .required {
            color: #ef4444;
            margin-left: 2px;
        }

        .input-group {
            position: relative;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
        }

        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            transform: translateY(-1px);
        }

        input[type="text"]:hover,
        input[type="email"]:hover,
        select:hover {
            border-color: #9ca3af;
        }

        textarea {
            resize: vertical;
        }

        input[type="file"] {
            font-size: 1rem;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #ffffff;
            width: 100%;
        }

        input[type="file"]:hover {
            border-color: #9ca3af;
        }

        input[type="file"]:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .input-labels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .other-labels {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        #file-label {
            color: #6b7280;
            font-size:0.8rem;
            margin-top: 0.5rem;
        }

        .product-selector {
            position: relative;
        }

        .product-dropdown-toggle {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #ffffff;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 3.5rem;
            transition: all 0.3s ease;
        }

        .product-dropdown-toggle:hover {
            border-color: #9ca3af;
        }

        .product-dropdown-toggle.active {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .selected-products {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .product-tag {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .product-tag .remove {
            cursor: pointer;
            width: 16px;
            height: 16px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .product-tag .remove:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
            color: #6b7280;
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .product-modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px 16px 0 0;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .search-container {
            padding: 1.5rem 2rem 1rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0 0 16px 16px;
        }

        .selected-count {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1563FF 0%, #012B90 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .product-checkboxes {
            padding: 1.5rem 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .checkbox-item:hover {
            background: #f8fafc;
            border-color: #e2e8f0;
        }

        .checkbox-item.selected {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 0.75rem;
            width: 18px;
            height: 18px;
            accent-color: #4f46e5;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            margin: 0;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .submit-container {
            margin-top: 3rem;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(135deg, #1563FF 0%, #012B90 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .placeholder-text {
            color: #9ca3af;
            font-style: italic;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        @media (max-width: 768px) {
            .form-content {
                padding: 1.5rem;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .input-labels {
                grid-template-columns: 1fr;
            }

            .product-checkboxes {
                grid-template-columns: 1fr;
            }

            .form-header h2 {
                font-size: 1.5rem;
            }
        }
    </style>

    <div class="form-container">
        <div class="form-header">
            <h2>Request a Quotation</h2>
        </div>

        <div class="form-content">
            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>

            <form id="quotation-form">
                <!-- End-user name -->
                <div class="form-group">
                    <label>End-user name <span class="required">*</span></label>
                    <div class="input-row">
                        <input type="text" id="first-name" name="first_name" placeholder="First name" required>
                        <input type="text" id="last-name" name="last_name" placeholder="Last name" required>
                    </div>
                    <div class="input-labels">
                        <span>First Name</span>
                        <span>Last Name</span>
                    </div>
                </div>

                <!-- End-user email -->
                <div class="form-group">
                    <label for="email">End-user email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" placeholder="Enter email address" required>
                </div>

                <!-- End-user company name -->
                <div class="form-group">
                    <label for="company">End-user company name <span class="required">*</span></label>
                    <input type="text" id="company" name="company" placeholder="Enter company name" required>
                </div>

                <!-- End-user location -->
                <div class="form-group">
                    <label for="location">End-user's location <span class="required">*</span></label>
                    <select id="location" name="location" required>
                        <option value="">Select province</option>
                        <option>Eastern Cape</option>
                        <option>Free State</option>
                        <option>Gauteng</option>
                        <option>KwaZulu-Natal</option>
                        <option>Limpopo</option>
                        <option>Mpumalanga</option>
                        <option>Northern Cape</option>
                        <option>North West</option>
                        <option>Western Cape</option>
                    </select>
                </div>

                <!-- End-user industry -->
                <div class="form-group">
                    <label for="industry">End-user's industry <span class="required">*</span></label>
                    <select id="industry" name="industry" required>
                        <option value="">Select industry</option>
                        <option>Africa ICT</option>
                        <option>Agriculture</option>
                        <option>Automotive</option>
                        <option>Broadcasting / Media</option>
                        <option>Chemical / Energy</option>
                        <option>Construction / Engineering</option>
                        <option>E Commerce</option>
                        <option>Education</option>
                        <option>Financial Services</option>
                        <option>Government</option>
                        <option>Healthcare</option>
                        <option>Housing / Development</option>
                        <option>ICT Supplier</option>
                        <option>Manufacturing</option>
                        <option>Mining</option>
                        <option>Non-Governmental Organization</option>
                        <option>NPO</option>
                        <option>Outsource Provider</option>
                        <option>Research / Development</option>
                        <option>Security</option>
                        <option>Service Providers - Legal</option>
                        <option>Sports</option>
                        <option>Telecommunications & ISP's</option>
                        <option>Tourism & Hospitality</option>
                        <option>Trade Union</option>
                        <option>Transportation</option>
                        <option>Water Utility</option>
                        <option>Wholesale and Retail Trade</option>
                    </select>
                </div>

                <!-- End-user sector -->
                <div class="form-group">
                    <label for="sector">End-user's sector <span class="required">*</span></label>
                    <select id="sector" name="sector" required>
                        <option value="">Select sector</option>
                        <option>Private</option>
                        <option>Public</option>
                    </select>
                </div>

                <!-- Products selection -->
                <div class="form-group">
                    <label>Potential product(s) <span class="required">*</span></label>
                    <div class="product-selector">
                        <div class="product-dropdown-toggle" id="product-dropdown-toggle">
                            <div class="selected-products" id="selected-products">
                                <span class="placeholder-text">Select products</span>
                            </div>
                            <div class="dropdown-arrow" id="dropdown-arrow">▼</div>
                        </div>
                    </div>
                    <span class="other-labels">Please choose the product(s) of interest</span>
                </div>

                <div class="form-group">
                    <label for="request-description">Please provide a description of the customer's request (edition, license type, quantities) <span class="required">*</span></label>
                    <textarea id="request-description" name="request_description" rows="4" required style="width: 100%; padding: 0.875rem 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem;"></textarea>
                </div>

                <div class="form-group">
                    <label for="request-type">Request type <span class="required">*</span></label>
                    <select id="request-type" name="request_type" required>
                        <option value="">Select request type</option>
                        <option value="License renewal">License renewal</option>
                        <option value="New license">New license</option>
                        <option value="Upgrade an existing license">Upgrade an existing license</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Required services</label>
                    <div class="product-checkboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="onsite-implementation" name="required_services" value="Onsite implementation">
                            <label for="onsite-implementation">Onsite implementation</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="onsite-training" name="required_services" value="Onsite training">
                            <label for="onsite-training">Onsite training</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="remote-implementation" name="required_services" value="Remote implementation">
                            <label for="remote-implementation">Remote implementation</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="remote-training" name="required_services" value="Remote training">
                            <label for="remote-training">Remote training</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="demo-session" name="demo_session">
                        <label for="demo-session">Does the end-user require a demo session?</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>File upload </label>
                    <input type="file" id="file-upload" name="uploaded_files" multiple>
                    <label for="file-upload" id="file-label">Upload any relevant files</label>
                </div>

                <div class="submit-container">
                    <button type="submit" class="submit-btn">Request Quotation</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Selection Modal -->
    <div class="modal-overlay" id="product-modal">
        <div class="product-modal">
            <div class="modal-header">
                <h3 class="modal-title">Select Products</h3>
                <button type="button" class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-container">
                    <input type="text" class="search-box" id="product-search" placeholder="Search products...">
                </div>
                <div class="product-checkboxes" id="product-checkboxes"></div>
            </div>
            <div class="modal-footer">
                <div class="selected-count" id="selected-count">0 products selected</div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="clear-all">Clear All</button>
                    <button type="button" class="btn-primary" id="apply-selection">Apply Selection</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const user = window.logged_in_user;
        const reseller_account = user["ID"][0];
        const reseller_contact = user["Contact ID"];

        console.log("reseller_account:", reseller_account);
        console.log("reseller_contact:", reseller_contact);


        const products = [
            "AD360", "ADAudit Plus", "ADManager Plus MSP", "ADManager Plus", "ADSelfService Plus", "Access Manager Plus",
            "AlarmsOne", "Analytics Plus", "AppCreator", "Application Control Plus", "Applications Manager",
            "AssetExplorer", "Browser Security Plus", "Cloud Security Plus", "CloudDNS", "CloudSpend", "DDI Central",
            "DataSecurity Plus", "Device Control Plus", "Endpoint Central MSP", "Endpoint Central", "Endpoint DLP Plus",
            "EventLog Analyzer MSSP", "EventLog Analyzer", "Exchange Reporter Plus", "FileAnalysis", "Firewall Analyzer",
            "Identity360", "Key Manager Plus", "Log360 Cloud", "Log360 MSSP", "Log360", "M365 Manager Plus",
            "M365 Security Plus", "Mobile Device Manager Plus MSP", "Mobile Device Manager Plus", "NetFlow Analyzer",
            "Network Configuration Manager", "OS Deployer", "OpManager MSP", "OpManager Plus", "OpManager", "OpUtils",
            "PAM360 MSP", "PAM360", "Password Manager Pro MSP", "Password Manager Pro", "Patch Connect Plus",
            "Patch Manager Plus", "RMM Central MSP", "RecoveryManager Plus", "Remote Access Plus", "SaaS Manager Plus",
            "ServiceDesk Plus MSP", "ServiceDesk Plus", "SharePoint Manager Plus", "Site24x7 MSP", "Site24x7 StatusIQ",
            "Site24x7", "SupportCenter Plus", "Vulnerability Manager Plus", "Zoho Assist", "Zoho Creator", "Zoho Lens",
            "Zoho Mail", "Zoho Meeting", "Zoho Projects", "Zoho Sprints", "Zoho Workplace"
        ];

        const productCheckboxes = document.getElementById('product-checkboxes');
        const selectedProductsContainer = document.getElementById('selected-products');
        const dropdownToggle = document.getElementById('product-dropdown-toggle');
        const productModal = document.getElementById('product-modal');
        const modalClose = document.getElementById('modal-close');
        const applySelection = document.getElementById('apply-selection');
        const clearAll = document.getElementById('clear-all');
        const productSearch = document.getElementById('product-search');
        const selectedCount = document.getElementById('selected-count');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');

        let selectedProducts = [];
        let filteredProducts = [...products];

        // Utility functions for showing messages
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
            // Scroll to top to show the message
            document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            // Scroll to top to show the message
            document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }

        // Initialize product checkboxes
        function renderProducts(productsToRender = products) {
            productCheckboxes.innerHTML = '';
            
            productsToRender.forEach(product => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                if (selectedProducts.includes(product)) {
                    checkboxItem.classList.add('selected');
                }
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'products';
                checkbox.value = product;
                checkbox.checked = selectedProducts.includes(product);
                checkbox.id = `product-${product.replace(/\s+/g, '-')}`;
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedProducts.includes(product)) {
                            selectedProducts.push(product);
                        }
                    } else {
                        selectedProducts = selectedProducts.filter(p => p !== product);
                    }
                    updateSelectedCount();
                    updateCheckboxStyles();
                });

                const label = document.createElement('label');
                label.textContent = product;
                label.setAttribute('for', checkbox.id);

                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                productCheckboxes.appendChild(checkboxItem);
            });
        }

        function updateCheckboxStyles() {
            document.querySelectorAll('.checkbox-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        function updateSelectedCount() {
            const count = selectedProducts.length;
            selectedCount.textContent = `${count} product${count !== 1 ? 's' : ''} selected`;
        }

        // Open modal
        dropdownToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            productModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            renderProducts();
            updateSelectedCount();
        });

        // Close modal
        function closeModal() {
            productModal.classList.remove('show');
            document.body.style.overflow = '';
            productSearch.value = '';
            filteredProducts = [...products];
        }

        modalClose.addEventListener('click', closeModal);

        // Close modal when clicking overlay
        productModal.addEventListener('click', function(e) {
            if (e.target === productModal) {
                closeModal();
            }
        });

        // Escape key to close modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && productModal.classList.contains('show')) {
                closeModal();
            }
        });

        // Search functionality
        productSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            filteredProducts = products.filter(product => 
                product.toLowerCase().includes(searchTerm)
            );
            renderProducts(filteredProducts);
        });

        // Clear all selections
        clearAll.addEventListener('click', function() {
            selectedProducts = [];
            renderProducts(filteredProducts);
            updateSelectedCount();
        });

        // Apply selection and close modal
        applySelection.addEventListener('click', function() {
            updateSelectedProducts();
            closeModal();
        });

        function updateSelectedProducts() {
            if (selectedProducts.length === 0) {
                selectedProductsContainer.innerHTML = '<span class="placeholder-text">Select products</span>';
            } else {
                selectedProductsContainer.innerHTML = selectedProducts.map(product => 
                    `<div class="product-tag">
                        ${product}
                        <div class="remove" onclick="removeProduct('${product}')">×</div>
                    </div>`
                ).join('');
            }
        }

        function removeProduct(productToRemove) {
            selectedProducts = selectedProducts.filter(p => p !== productToRemove);
            updateSelectedProducts();
        }

        // Initialize
        renderProducts();
        updateSelectedProducts();

        // Form submission
        document.getElementById('quotation-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            hideMessages(); // Hide any previous messages

            if (selectedProducts.length === 0) {
                showError('Please select at least one product.');
                return;
            }

            const form = e.target;
            const formData = new FormData(form);

            // Add selected products to formData
            if (selectedProducts.length > 0) {
                selectedProducts.forEach(product => {
                    formData.append('products', product);
                });
            } else {
                // Handle case where no products are selected, though we check above
                showError('At least one product must be selected.');
                return;
            }

            // Get required services
            const requiredServices = [];
            document.querySelectorAll('input[name="required_services"]:checked').forEach(checkbox => {
                requiredServices.push(checkbox.value);
            });
            formData.set('required_services', requiredServices.join(', '));
            
            // Append file(s)
            /*
            const fileInput = document.getElementById('file-upload');
            for (const file of fileInput.files) {
                formData.append('uploaded_files', file);
            }
                */

            // Append reseller information from the user object
            formData.append('reseller_account', reseller_account);
            formData.append('reseller_contact', reseller_contact);

            const submitBtn = form.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                const response = await fetch('https://certificateanalyzer-893656151.development.catalystserverless.com/server/request-quotation/api/processQuotation', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (response.ok) {
                    showSuccess(result.message);
                    form.reset();
                    selectedProducts = [];
                    updateSelectedProducts();
                    renderProducts();
                } else {
                    showError(result.error || 'An unexpected error occurred.');
                }
            } catch (error) {
                console.error('Submission error:', error);
                showError('An error occurred while submitting the form. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Request Quotation';
            }
        });
    </script>